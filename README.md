# HEU_DSP_Final-design_Piano
Ein Programm für HEU-Studenten im ersten Studienjahr  

## 1. 项目文件清单
| 文件名                | 类型       | 功能说明                                                                 |
|-----------------------|------------|--------------------------------------------------------------------------|
| A4.mp3                | 音频文件   | 现实钢琴的A4标准音（440Hz），作为分析与复现的原始参考音频                |
| piano-anas.m          | MATLAB脚本 | 分析A4.mp3的时域/频域数据，提取泛音强度与分布规律                        |
| *.fig                 | 图像文件   | `piano-anas.m` 运行后生成的时域波形图、频域频谱图（直观展示泛音特征）    |
| piano-make.m          | MATLAB脚本 | 基础钢琴音色合成脚本，生成纯音、带泛音钢琴音、和弦等音频                |
| pure_tone_A4.wav      | 合成音频   | 440Hz纯音（正弦波，无泛音，作为音色对比基准）                           |
| piano_tone_C4.wav     | 合成音频   | 带泛音的C4音（比纯音更接近钢琴音色）                                     |
| major_chord_C4.wav    | 合成音频   | C大三和弦（多音叠加，展示和声效果）                                     |
| piano_adsr_C4.wav     | 合成音频   | 带ADSR包络的C4音（模拟真实钢琴的响度衰减，动态感最强）                   |
| A4_RealMake.m         | MATLAB脚本 | 结合“泛音结构+指数衰减”，复现A4.mp3的真实音色                           |
| Real_A4_By_Piano.wav  | 复现音频   | `A4_RealMake.m` 运行后生成的A4音复现结果（与A4.mp3对比听感）             |


## 2. 快速使用指南
### 2.1 前置条件
- 安装 **MATLAB R2020b 及以上版本**（需支持 `audioread`、`fft`、`audiowrite` 等基础函数，无需额外工具箱）。
- 确保所有文件放在同一文件夹下（避免路径错误）。

### 2.2 核心操作步骤
1. **分析真实钢琴音**  
   打开 `piano-anas.m`，找到音频读取代码行，将 `A4.mp3` 的路径替换为本地实际路径（若文件在同一文件夹，直接用文件名即可）：  
   ```matlab
   % 示例：若A4.mp3与脚本同目录，直接写文件名
   [audio_signal, fs] = audioread('A4.mp3'); 
   ```  
   运行脚本，生成时域/频域图，观察泛音分布规律。

2. **合成基础钢琴音色**  
   直接运行 `piano-make.m`，脚本会自动生成 4 种基础音频文件（见“项目文件清单”），可通过MATLAB的“音频播放器”或本地播放器听感对比。

3. **复现真实A4音**  
   运行 `A4_RealMake.m`，脚本会结合从 `piano-anas.m` 提取的泛音参数，生成复现音频 `Real_A4_By_Piano.wav`，与原始 `A4.mp3` 对比复现效果。


## 3. 技术原理说明
钢琴音色的“悦耳感”源于物理振动的 **泛音结构** 与 **动态衰减特性**，项目核心是通过信号处理复现这两个关键特征。

### 3.1 钢琴音色的核心特性（为何比纯音悦耳？）
#### （1）泛音结构：音色的“基因”
钢琴弦振动时，除了“整体振动”产生的 **基频**（如A4的440Hz），弦的1/2、1/3、1/4等分点会同时振动，产生 **泛音**（频率为基频的2倍、3倍、4倍…）：  
- 示例：A4（440Hz）的泛音包括 880Hz（2次）、1320Hz（3次）、1760Hz（4次）等。  
- 关键：泛音的 **振幅比例固定**（基频最强，泛音随次数递减），形成钢琴独有的“频谱指纹”，人耳感知为“自然和谐”。

#### （2）ADSR包络：声音的“呼吸感”
纯音的振幅始终不变（机械感强），而钢琴音有明显的 **动态衰减**，即 ADSR 包络：  
- **起音（A）**：琴槌击弦瞬间，振幅快速上升（10-50ms），高次泛音先激发，带来“清脆感”。  
- **衰减（D）**：振幅快速下降到稳定值（50-200ms）。  
- **持续（S）**：振幅保持稳定，基频主导，泛音逐渐减弱。  
- **释音（R）**：按键松开后，振幅缓慢衰减至0（1-2s），泛音先消失，留下“余韵”。

#### （3）非谐性与微颤：增加“人情味”
- 非谐性：泛音频率并非严格整数倍（如2次泛音可能是882Hz而非880Hz），源于钢琴弦的刚性特性。  
- 微颤：基频有±1Hz的微小波动，模拟弦振动的“不完美”，避免电子音的“冰冷感”。

### 3.2 音色仿真的核心步骤
项目通过3步复现钢琴音色，对应代码逻辑：
1. **构建泛音频谱**  
   从 `A4.mp3` 提取基频与泛音的振幅比例（如基频100%、2次泛音62%、3次泛音18%），用多个正弦波叠加生成复合信号（见 `piano-make.m` 泛音合成部分）。

2. **添加ADSR衰减包络**  
   用指数衰减函数调制复合信号的振幅，模拟真实钢琴的响度变化（见 `A4_RealMake.m` 包络生成部分）。

3. **加入“非完美”特性**  
   微调泛音频率（非谐性）、给基频添加微小波动（微颤），进一步贴近真实钢琴音（代码中可通过修改泛音频率参数实现）。


## 4. 注意事项
1. 若 `audioread` 无法读取A4.mp3，可将其转换为WAV格式（用Audacity等工具），或在代码中替换为WAV文件路径。  
2. 运行脚本后若音频音量过小，可在代码中添加振幅放大逻辑（如 `piano_tone = piano_tone * 1.5;`，注意避免过载失真）。  
3. 时域/频域图可通过MATLAB的“保存”按钮导出，用于课程报告展示。


## 5. 参考资料
- MATLAB官方文档：[音频信号处理基础](https://www.mathworks.com/help/audio/index.html)  
- 声学原理：钢琴弦振动的泛音结构与ADSR包络特性  
- DSP课程课件：傅里叶变换（频域分析）、信号合成与调制相关内容
